<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Documentaiton for Document.js</title>
    <link href='stylesheet.css' rel='stylesheet' />
  </head>
  <body>
    <figure id='relations'>
      <h2>Requires</h2>
      <ul>
        <li>LSD.Node</li>
        <li>LSD.Module.Attributes</li>
        <li>LSD.Module.DOM</li>
        <li>LSD.Module.Events</li>
        <li>LSD.Module.Layout</li>
      </ul>
      <h2>Provides</h2>
      <ul>
        <li>LSD.Document</li>
      </ul>
    </figure>
    <header>
      <h1>Document.js</h1>
      <p>Provides a virtual root to all the widgets. DOM-Compatible for Slick traversals.</p>
      <dl>
        <dt>License:</dt>
        <dd>Public domain (http://unlicense.org).</dd>
        <dt>Authors:</dt>
        <dd>Yaroslaff Fedin</dd>
      </dl>
    </header>
    <section>
      <p>Document is a big disguise proxy class that contains the tree
      of widgets and a link to document element.</p>
      
      <p>It is DOM-compatible (to some degree), so tools that crawl DOM
      tree (we use Slick) can work with the widget tree like it usually
      does with the real DOM so we get selector engine for free.</p>
      
      <p>The class contains a few hacks that allows Slick to initialize.</p>
    </section>
    <figure>
      <ol>
        <li>38</li>
        <li>39</li>
        <li>40</li>
        <li>41</li>
        <li>42</li>
        <li>43</li>
        <li>44</li>
        <li>45</li>
        <li>46</li>
        <li>47</li>
        <li>48</li>
        <li>49</li>
        <li>50</li>
        <li>51</li>
        <li>52</li>
        <li>53</li>
        <li>54</li>
        <li>55</li>
        <li>56</li>
        <li>57</li>
        <li>58</li>
        <li>59</li>
        <li>60</li>
        <li>61</li>
        <li>62</li>
        <li>63</li>
        <li>64</li>
        <li>65</li>
        <li>66</li>
        <li>67</li>
        <li>68</li>
        <li>69</li>
        <li>70</li>
        <li>71</li>
        <li>72</li>
        <li>73</li>
        <li>74</li>
        <li>75</li>
        <li>76</li>
        <li>77</li>
        <li>78</li>
        <li>79</li>
        <li>80</li>
        <li>81</li>
        <li>82</li>
        <li>83</li>
        <li>84</li>
        <li>85</li>
        <li>86</li>
        <li>87</li>
        <li>88</li>
        <li>89</li>
        <li>90</li>
        <li>91</li>
        <li>92</li>
        <li>93</li>
        <li>94</li>
        <li>95</li>
        <li>96</li>
        <li>97</li>
        <li>98</li>
        <li>99</li>
        <li>100</li>
        <li>101</li>
        <li>102</li>
        <li>103</li>
        <li>104</li>
        <li>105</li>
        <li>106</li>
        <li>107</li>
        <li>108</li>
        <li>109</li>
        <li>110</li>
        <li>111</li>
        <li>112</li>
        <li>113</li>
        <li>114</li>
        <li>115</li>
        <li>116</li>
        <li>117</li>
        <li>118</li>
        <li>119</li>
        <li>120</li>
        <li>121</li>
        <li>122</li>
        <li>123</li>
        <li>124</li>
        <li>125</li>
        <li>126</li>
        <li>127</li>
        <li>128</li>
        <li>129</li>
        <li>130</li>
      </ol>
      <code><span class="nx">LSD</span><span class="p">.</span><span class="nx">Document</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Class</span><span class="p">({</span>&#x000A;&#x000A;  <span class="nx">Includes</span><span class="o">:</span> <span class="p">[</span>&#x000A;    <span class="nx">LSD</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span>&#x000A;    <span class="nx">LSD</span><span class="p">.</span><span class="nx">Module</span><span class="p">.</span><span class="nx">Attributes</span><span class="p">,</span>&#x000A;    <span class="nx">LSD</span><span class="p">.</span><span class="nx">Module</span><span class="p">.</span><span class="nx">DOM</span><span class="p">,</span>&#x000A;    <span class="nx">LSD</span><span class="p">.</span><span class="nx">Module</span><span class="p">.</span><span class="nx">Events</span><span class="p">,</span>&#x000A;    <span class="nx">LSD</span><span class="p">.</span><span class="nx">Module</span><span class="p">.</span><span class="nx">Layout</span>&#x000A;  <span class="p">],</span>&#x000A;&#x000A;  <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>&#x000A;    <span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;#document&#39;</span><span class="p">,</span>&#x000A;    <span class="nx">root</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// topmost widget&#39;s parentNode is the document if set to true</span>&#x000A;    <span class="nx">layout</span><span class="o">:</span> <span class="p">{</span>&#x000A;      <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;augment&#39;</span>&#x000A;    <span class="p">},</span>&#x000A;    <span class="nx">nodeType</span><span class="o">:</span> <span class="mi">9</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">LSD</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span> <span class="nx">LSD</span><span class="p">.</span><span class="nb">document</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">LSD</span><span class="p">.</span><span class="nb">document</span><span class="p">);</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="nx">element</span><span class="p">,</span> <span class="nx">options</span><span class="p">]);</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">;</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nb">document</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">documentElement</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>&#x000A;    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">!=</span> <span class="mi">9</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">ownerDocument</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>&#x000A;&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">xml</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">navigator</span> <span class="o">=</span> <span class="p">{};</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span> <span class="o">=</span> <span class="p">{};</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">slickFeatures</span> <span class="o">=</span> <span class="p">{</span>&#x000A;      <span class="nx">brokenStarGEBTN</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>&#x000A;      <span class="nx">starSelectsClosedQSA</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>&#x000A;      <span class="nx">idGetsName</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>&#x000A;      <span class="nx">brokenMixedCaseQSA</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>&#x000A;      <span class="nx">brokenGEBCN</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>&#x000A;      <span class="nx">brokenCheckedQSA</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>&#x000A;      <span class="nx">brokenEmptyAttributeQSA</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>&#x000A;      <span class="nx">isHTMLDocument</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>&#x000A;      <span class="nx">nativeMatchesSelector</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>&#x000A;      <span class="nx">hasAttribute</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">attribute</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="k">return</span> <span class="p">(</span><span class="nx">attribute</span> <span class="k">in</span> <span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)</span> <span class="o">||</span> <span class="p">((</span><span class="nx">attribute</span> <span class="k">in</span> <span class="nx">node</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">states</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">attribute</span> <span class="k">in</span> <span class="nx">node</span><span class="p">.</span><span class="nx">pseudos</span><span class="p">))</span>&#x000A;      <span class="p">},</span>&#x000A;      <span class="nx">getAttribute</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">attribute</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">attribute</span><span class="p">]</span> <span class="o">||</span> <span class="p">((</span><span class="nx">attribute</span> <span class="k">in</span> <span class="nx">node</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">states</span><span class="p">)</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">pseudos</span><span class="p">[</span><span class="nx">attribute</span><span class="p">]);</span>&#x000A;      <span class="p">},</span>&#x000A;      <span class="nx">compareDocumentPosition</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">localName</span> <span class="o">?</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">localName</span> <span class="o">?</span> <span class="nx">self</span> <span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">toElement</span><span class="p">())</span> <span class="o">:</span> <span class="nx">self</span><span class="p">;</span>&#x000A;        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="k">do</span> <span class="p">{</span>&#x000A;        	<span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">===</span> <span class="nx">context</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>&#x000A;        <span class="p">}</span> <span class="k">while</span> <span class="p">((</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">));</span>&#x000A;        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>&#x000A;      <span class="p">},</span>&#x000A;      <span class="nx">documentSorter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="k">return</span> <span class="nx">features</span><span class="p">.</span><span class="nx">compareDocumentPosition</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">4</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="nx">a</span> <span class="o">===</span> <span class="nx">b</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>&#x000A;      <span class="p">}</span>&#x000A;    <span class="p">}</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">events</span><span class="p">;</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">dominjected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">build</span><span class="p">();</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="nx">setParent</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">widget</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">root</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="nx">id</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">render</span><span class="p">)</span> <span class="k">return</span> <span class="nx">item</span><span class="p">;</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="nx">addStylesheet</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sheet</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">stylesheets</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">stylesheets</span> <span class="o">=</span> <span class="p">[];</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">stylesheets</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="nx">sheet</span><span class="p">);</span>&#x000A;    <span class="nx">sheet</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="nx">removeStylesheet</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sheet</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">stylesheets</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">stylesheets</span><span class="p">.</span><span class="nx">erase</span><span class="p">(</span><span class="nx">sheet</span><span class="p">);</span>&#x000A;    <span class="nx">sheet</span><span class="p">.</span><span class="nx">detach</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="nx">createFragment</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="kd">var</span> <span class="nx">fragment</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createFragment</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">fireEvent</span><span class="p">(</span><span class="s1">&#39;DOMNodeInserted&#39;</span><span class="p">,</span> <span class="nx">fragment</span><span class="p">);</span>&#x000A;    <span class="k">return</span> <span class="nx">fragment</span><span class="p">;</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;<span class="nx">LSD</span><span class="p">.</span><span class="nx">Document</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addState</span><span class="p">(</span><span class="s1">&#39;built&#39;</span><span class="p">);</span>&#x000A;&#x000A;<span class="nx">LSD</span><span class="p">.</span><span class="nx">Document</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addEvents</span><span class="p">({</span>&#x000A;  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">watch</span><span class="p">)</span> <span class="p">{</span></code>
    </figure>
    <section>
      <p>Attach behaviour expectations</p>
    </section>
    <figure>
      <ol>
        <li>132</li>
      </ol>
      <code><span class="nx">LSD</span><span class="p">.</span><span class="nx">Module</span><span class="p">.</span><span class="nx">Expectations</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></code>
    </figure>
    <section>
      <p>Attach action expectations</p>
    </section>
    <figure>
      <ol>
        <li>134</li>
        <li>135</li>
      </ol>
      <code><span class="nx">LSD</span><span class="p">.</span><span class="nx">Module</span><span class="p">.</span><span class="nx">Actions</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>&#x000A;    <span class="p">}</span></code>
    </figure>
    <section>
      <p>Attach stylesheets, if there are stylesheets loaded</p>
    </section>
    <figure>
      <ol>
        <li>137</li>
        <li>138</li>
        <li>139</li>
      </ol>
      <code><span class="k">if</span> <span class="p">(</span><span class="nx">LSD</span><span class="p">.</span><span class="nx">Sheet</span> <span class="o">&amp;&amp;</span> <span class="nx">LSD</span><span class="p">.</span><span class="nx">Sheet</span><span class="p">.</span><span class="nx">stylesheets</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">sheet</span><span class="p">;</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="nx">LSD</span><span class="p">.</span><span class="nx">Sheet</span><span class="p">.</span><span class="nx">stylesheets</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">];)</span> <span class="k">this</span><span class="p">.</span><span class="nx">addStylesheet</span><span class="p">(</span><span class="nx">sheet</span><span class="p">);</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="p">});</span></code>
    </figure>
    <section>
      <p>Properties set here will be picked up by first document</p>
    </section>
    <figure>
      <ol>
        <li>142</li>
      </ol>
      <code><span class="nx">LSD</span><span class="p">.</span><span class="nb">document</span> <span class="o">=</span> <span class="p">{};</span></code>
    </figure>
  </body>
</html>
